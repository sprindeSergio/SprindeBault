<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Contraseñas - Admin</title>
    <link rel="stylesheet" href="/static/styles_crud.css">
</head>
<body>
    <div class="container">
        <h1>Gestión de Contraseñas</h1>

        <!-- Formulario para crear contraseña -->
        <h2>Crear Contraseña</h2>
        <form action="/create_password" method="post">
            <label for="password">Nueva Contraseña:</label>
            <input type="password" id="password" name="password" required>

            <label for="confirm_password">Confirmar Contraseña:</label>
            <input type="password" id="confirm_password" name="confirm_password" required>

            <button type="submit">Guardar</button>
        </form>

        <!-- Tabla con las contraseñas existentes -->
        <h2>Lista de Contraseñas</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Email</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <!-- Aquí se llenarán los datos desde la API -->
            </tbody>
        </table>

        <a href="/dashboard"><button class="back-button">Volver al Dashboard</button></a>
    </div>
    
    <script>
        async function loadPasswords() {
            try {
                const response = await fetch("/get_passwords");
                if (!response.ok) {
                    throw new Error(`Error: ${response.status}`);
                }
    
                const passwords = await response.json();
                if (!Array.isArray(passwords)) {
                    throw new Error("Los datos recibidos no son una lista.");
                }
    
                const tbody = document.querySelector("tbody");
                tbody.innerHTML = "";  // Limpiar tabla
    
                passwords.forEach(pass => {
                    let row = `
                        <tr>
                            <td>${pass.id}</td>
                            <td>${pass.email}</td>
                            <td>
                                <button onclick="deletePassword(${pass.id})">Eliminar</button>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            } catch (error) {
                console.error("Error al cargar contraseñas:", error);
            }
        }
    
        document.addEventListener("DOMContentLoaded", loadPasswords);
    </script>    
</body>
</html>